# ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒªãƒ³ã‚°ãƒ»ã‚¬ã‚¤ãƒ‰

**ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ©ãƒ¼ã‚’ä½¿ã£ãŸãƒœãƒˆãƒ«ãƒãƒƒã‚¯ã®ç‰¹å®šã¨æ”¹å–„ã®æ‰‹é †**

---

## âš ï¸ æœ€é‡è¦: å…ƒã®ã‚³ãƒ¼ãƒ‰ã‚’çµ¶å¯¾ã«ç ´å£Šã—ãªã„ã§ãã ã•ã„

### åŸºæœ¬ãƒ«ãƒ¼ãƒ«

```
âœ… ã‚„ã‚‹ã“ã¨:
- æ–°ã—ãå®Ÿé¨“ç”¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œã‚‹
- å…ƒã®ã‚³ãƒ¼ãƒ‰ã¯ã‚³ãƒ”ãƒ¼ã—ã¦ä½¿ã†
- æ”¹å–„å‰å¾Œã‚’åˆ¥ã€…ã«æ¸¬å®šã™ã‚‹

âŒ çµ¶å¯¾ã«ã‚„ã£ã¦ã¯ã„ã‘ãªã„ã“ã¨:
- å…ƒã®ãƒ„ãƒ¼ãƒ«ã‚„ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ç›´æ¥ä¿®æ­£ã™ã‚‹
- å…ƒã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ãƒ¼ã‚’è¿½åŠ ã™ã‚‹
- æœ¬ç•ªç’°å¢ƒã®ã‚³ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã™ã‚‹
```

### ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆï¼ˆä¾‹ï¼‰

```
project/
â”œâ”€â”€ my_tool.py              â† å…ƒã®ã‚³ãƒ¼ãƒ‰ï¼ˆå¤‰æ›´ã—ãªã„ï¼ï¼‰
â”œâ”€â”€ verify_improvement.py   â† æ–°è¦ä½œæˆï¼šå®Ÿé¨“ç”¨ãƒ•ã‚¡ã‚¤ãƒ«
â”œâ”€â”€ profile_main_*.stats    â† è‡ªå‹•ç”Ÿæˆã•ã‚ŒãŸãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒªãƒ³ã‚°çµæœ
â””â”€â”€ profile_main_*.txt      â† è‡ªå‹•ç”Ÿæˆã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆãƒ¬ãƒãƒ¼ãƒˆ
```

**é‡è¦: `my_tool.py` ã¯ä¸€åˆ‡è§¦ã‚‰ãšã€`verify_improvement.py` ã§å®Ÿé¨“ã—ã¾ã™ã€‚**

---

## ğŸ¯ ã“ã®ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ©ãƒ¼ã§ã§ãã‚‹ã“ã¨

1. **ãƒœãƒˆãƒ«ãƒãƒƒã‚¯ã®ç‰¹å®š**: ã©ã®é–¢æ•°ãŒé…ã„ã‹ã‚’æ•°å­—ã§ç‰¹å®š
2. **æ”¹å–„ã®åŠ¹æœæ¸¬å®š**: æœ€é©åŒ–å‰å¾Œã‚’æ¯”è¼ƒã—ã¦åŠ¹æœã‚’è¨¼æ˜
3. **è‡ªå‹•ä¿å­˜**: å®Ÿè¡Œã™ã‚‹ãŸã³ã«ãƒ¬ãƒãƒ¼ãƒˆãŒè‡ªå‹•ç”Ÿæˆã•ã‚Œã‚‹

---

## ğŸš€ ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

### åŸºæœ¬çš„ãªä½¿ã„æ–¹

```bash
# æ—¢å­˜ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒªãƒ³ã‚°ï¼ˆã‚³ãƒ¼ãƒ‰ä¿®æ­£ä¸è¦ï¼‰
python -m pyprofiler my_script.py

# ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³å¼•æ•°ã‚‚æ¸¡ã›ã‚‹
python -m pyprofiler my_script.py arg1 arg2

# è‡ªå‹•ä¿å­˜ãªã—ã§å®Ÿè¡Œ
python -m pyprofiler --no-auto-save my_script.py
```

### Pythonã‚³ãƒ¼ãƒ‰ã‹ã‚‰ä½¿ã†

```python
import pyprofiler

# ã‚³ãƒ¼ãƒ‰ã‚’æ–‡å­—åˆ—ã§æ¸¡ã—ã¦ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒªãƒ³ã‚°
pyprofiler.run('''
def my_function():
    result = sum(range(10000))
    return result

my_function()
''')
```

---

## ğŸ“Š ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒªãƒ³ã‚°çµæœã®è¦‹æ–¹

### å‡ºåŠ›ä¾‹

```
Function                       Calls      Total(s)     Own(s)       %
--------------------------------------------------------------------------------
main                           1          0.119856     0.119856        8.4%
list_workflows                 1          0.098897     0.098897        7.0%
process_data                   10         0.050000     0.050000       35.0%
```

### å„åˆ—ã®æ„å‘³

| åˆ— | æ„å‘³ |
|----|------|
| **Function** | é–¢æ•°å |
| **Calls** | å‘¼ã³å‡ºã—å›æ•° |
| **Total(s)** | ç·å®Ÿè¡Œæ™‚é–“ï¼ˆç§’ï¼‰ |
| **Own(s)** | è‡ªèº«ã®å®Ÿè¡Œæ™‚é–“ï¼ˆå­é–¢æ•°ã‚’é™¤ãï¼‰ |
| **%** | ç·æ™‚é–“ã«å ã‚ã‚‹å‰²åˆ |

### ãƒœãƒˆãƒ«ãƒãƒƒã‚¯ã®è¦‹æ–¹

```
âœ… ãƒœãƒˆãƒ«ãƒãƒƒã‚¯ã®åˆ¤æ–­åŸºæº–:
- % ãŒå¤§ãã„ï¼ˆ30%ä»¥ä¸Šï¼‰â†’ æ”¹å–„ã®ä½™åœ°å¤§
- Calls ãŒç•°å¸¸ã«å¤šã„ â†’ æœ€é©åŒ–ã®ä½™åœ°ã‚ã‚Š
- Total(s) ãŒå¤§ãã„ â†’ ã“ã“ã‚’ç›´ã›ã°å…¨ä½“ãŒé€Ÿããªã‚‹
```

---

## ğŸ”§ å®Ÿè·µçš„ãªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

### ã‚¹ãƒ†ãƒƒãƒ—0: æº–å‚™ï¼ˆå…ƒã®ã‚³ãƒ¼ãƒ‰ã‚’å®ˆã‚‹ï¼‰

```bash
# 1. ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œã‚‹
mkdir profiling_experiment
cd profiling_experiment

# 2. å…ƒã®ã‚³ãƒ¼ãƒ‰ã‚’ç¢ºèªã™ã‚‹ï¼ˆçµ¶å¯¾ã«ç·¨é›†ã—ãªã„ï¼ï¼‰
cat ../my_tool.py  # ä¸­èº«ã‚’è¦‹ã‚‹ã ã‘

# 3. å®Ÿé¨“ç”¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ–°è¦ä½œæˆã™ã‚‹
touch verify_improvement.py
```

### ã‚¹ãƒ†ãƒƒãƒ—1: ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒªãƒ³ã‚°ã‚’å®Ÿè¡Œ

```bash
cd C:/Users/kakar/sync_project/20260112/159_workflow-engine
python -m pyprofiler main.py list
```

**ãƒ¡ãƒ¢**: ã“ã®æ™‚ç‚¹ã§ã¯å…ƒã®ã‚³ãƒ¼ãƒ‰ã¯ä¸€åˆ‡å¤‰æ›´ã—ã¦ã„ã¾ã›ã‚“ã€‚

### ã‚¹ãƒ†ãƒƒãƒ—2: çµæœã‚’ç¢ºèªï¼ˆè‡ªå‹•ä¿å­˜ã•ã‚ŒãŸãƒ¬ãƒãƒ¼ãƒˆã‚’èª­ã‚€ï¼‰

```bash
# è‡ªå‹•ä¿å­˜ã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆãƒ¬ãƒãƒ¼ãƒˆã‚’é–‹ã
cat profile_main_*.txt | head -30
```

```
Function                       Calls      Total(s)     Own(s)       %
--------------------------------------------------------------------------------
list_workflows                 1          0.098897     0.098897        7.0%
from_yaml_file                 2          0.088882     0.088882        6.1%
```

â†’ `list_workflows` ãŒæœ€ã‚‚æ™‚é–“ãŒã‹ã‹ã£ã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚‹

### ã‚¹ãƒ†ãƒƒãƒ—3: æ”¹å–„æ¡ˆã‚’æ¤œè¨ï¼ˆé ­ã®ä¸­ã§è€ƒãˆã‚‹ï¼‰

```
ã‚¢ã‚¤ãƒ‡ã‚¢:
- YAMLãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã™ã‚‹
- è¤‡æ•°ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¸¦åˆ—ã—ã¦èª­ã¿è¾¼ã‚€
- ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’å¤‰ãˆã‚‹
```

**é‡è¦**: ã¾ã å…ƒã®ã‚³ãƒ¼ãƒ‰ã¯è§¦ã‚Šã¾ã›ã‚“ã€‚

### ã‚¹ãƒ†ãƒƒãƒ—4: æ”¹å–„ã®åŠ¹æœã‚’æ¤œè¨¼ï¼ˆæ–°ã—ã„ãƒ•ã‚¡ã‚¤ãƒ«ã§å®Ÿé¨“ï¼‰

**æ–°ã—ã„ãƒ•ã‚¡ã‚¤ãƒ« `verify_improvement.py` ã‚’ä½œæˆ:**

```python
# verify_improvement.py â† æ–°è¦ä½œæˆ

import pyprofiler

print("=== BEFORE: å…ƒã®å®Ÿè£… ===")
code_before = '''
def list_workflows():
    # å…ƒã®ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦è²¼ã‚Šä»˜ã‘
    workflows = []
    for file in yaml_files:
        with open(file) as f:
            workflows.append(yaml.safe_load(f))
    return workflows

# ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’æº–å‚™
yaml_files = ['workflow1.yaml', 'workflow2.yaml']
list_workflows()
'''

pyprofiler.run(code_before)

print("\n=== AFTER: æ”¹å–„ç‰ˆ ===")
code_after = '''
def list_workflows_optimized():
    # æ”¹å–„ç‰ˆã‚’æ›¸ã
    workflows = []
    cache = {}
    for file in yaml_files:
        if file in cache:
            workflows.append(cache[file])
        else:
            with open(file) as f:
                data = yaml.safe_load(f)
                cache[file] = data
                workflows.append(data)
    return workflows

# åŒã˜ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã§æ¤œè¨¼
yaml_files = ['workflow1.yaml', 'workflow2.yaml']
list_workflows_optimized()
'''

pyprofiler.run(code_after)
```

**ãƒã‚¤ãƒ³ãƒˆ:**
- å…ƒã® `my_tool.py` ã¯ä¸€åˆ‡å¤‰æ›´ã—ãªã„
- `verify_improvement.py` ã¨ã„ã†æ–°ã—ã„ãƒ•ã‚¡ã‚¤ãƒ«ã§å®Ÿé¨“
- å…ƒã®ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ä½¿ã†

### ã‚¹ãƒ†ãƒƒãƒ—5: çµæœã‚’æ¯”è¼ƒ

```
BEFORE:
list_workflows        0.098897ç§’    (7.0%)

AFTER:
list_workflows_optimized    0.045000ç§’    (3.5%)

æ”¹å–„ç‡: 54.5%é«˜é€ŸåŒ– âœ…
```

### ã‚¹ãƒ†ãƒƒãƒ—6: æ”¹å–„ãŒæˆåŠŸã—ãŸã‚‰åˆã‚ã¦å…ƒã®ã‚³ãƒ¼ãƒ‰ã«é©ç”¨

```bash
# ã“ã“ã§åˆã‚ã¦å…ƒã®ã‚³ãƒ¼ãƒ‰ã‚’ä¿®æ­£ã™ã‚‹
vim ../my_tool.py
# æ”¹å–„ç‰ˆã‚’å®Ÿè£…ã™ã‚‹
```

**é‡è¦ãªé †åº:**
1. ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒªãƒ³ã‚°ï¼ˆå…ƒã®ã‚³ãƒ¼ãƒ‰ã¯å¤‰æ›´ã—ãªã„ï¼‰
2. å®Ÿé¨“ç”¨ãƒ•ã‚¡ã‚¤ãƒ«ã§æ¤œè¨¼
3. åŠ¹æœã‚’ç¢ºèª
4. **æœ€å¾Œã«**å…ƒã®ã‚³ãƒ¼ãƒ‰ã‚’ä¿®æ­£

---

## ğŸ“ è‡ªå‹•ä¿å­˜ã•ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ«

å®Ÿè¡Œã™ã‚‹ã¨è‡ªå‹•çš„ã«2ã¤ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒä¿å­˜ã•ã‚Œã¾ã™ï¼š

```
profile_main_20260118_205418.stats   â† Pickleå½¢å¼ï¼ˆãƒ—ãƒ­ã‚°ãƒ©ãƒ ã§èª­ã¿å–ã‚Šå¯èƒ½ï¼‰
profile_main_20260118_205418.txt     â† ãƒ†ã‚­ã‚¹ãƒˆãƒ¬ãƒãƒ¼ãƒˆï¼ˆäººé–“ãŒèª­ã‚ã‚‹ï¼‰
```

### ãƒ†ã‚­ã‚¹ãƒˆãƒ¬ãƒãƒ¼ãƒˆã®å†…å®¹

```
Profiling Report: main.py
Generated: 2026-01-18 20:54:18
Total Time: 1.4192s
Functions Profiled: 646
================================================================================

Function                       Calls      Total(s)     Own(s)       %
--------------------------------------------------------------------------------
main                           1          0.119856     0.119856        8.4%
list_workflows                 1          0.098897     0.098897        7.0%
...
```

---

## ğŸ’¡ å®Ÿä¾‹é›†

### å®Ÿä¾‹1: filter + lambda ã‚’ list comprehension ã«å¤‰æ›´

**BEFORE:**
```
filter_method        0.025563ç§’    (97.7%)
```

**æ”¹å–„ã‚³ãƒ¼ãƒ‰:**
```python
# å…ƒã®ã‚³ãƒ¼ãƒ‰ï¼ˆé…ã„ï¼‰
def filter_method(n):
    return list(filter(lambda x: x % 2 == 0, map(lambda x: x**2, range(n))))

# æ”¹å–„ç‰ˆï¼ˆé€Ÿã„ï¼‰
def list_comp_method(n):
    return [x**2 for x in range(n) if x % 2 == 0]
```

**çµæœ:**
```
list_comp_method   0.000482ç§’
æ”¹å–„ç‡: 97.1%é«˜é€ŸåŒ– âœ…
```

### å®Ÿä¾‹2: bubble sort ã‚’ sorted() ã«å¤‰æ›´

**BEFORE:**
```
bubble_sort        0.001832ç§’    (82.1%)
```

**æ”¹å–„ã‚³ãƒ¼ãƒ‰:**
```python
# å…ƒã®ã‚³ãƒ¼ãƒ‰ï¼ˆé…ã„ï¼‰
def bubble_sort(arr):
    n = len(arr)
    for i in range(n):
        for j in range(0, n-i-1):
            if arr[j] > arr[j+1]:
                arr[j], arr[j+1] = arr[j+1], arr[j]
    return arr

# æ”¹å–„ç‰ˆï¼ˆé€Ÿã„ï¼‰
def builtin_sort(arr):
    return sorted(arr)
```

**çµæœ:**
```
builtin_sort       0.000034ç§’
æ”¹å–„ç‡: 86.5%é«˜é€ŸåŒ– âœ…
```

---

## âš ï¸ æ³¨æ„ç‚¹

### æœ€é©åŒ–ãŒé€†åŠ¹æœã«ãªã‚‹ã“ã¨ã‚‚

Test 3ï¼ˆè¡Œåˆ—æ¼”ç®—ï¼‰ã®ä¾‹ï¼š
```
BEFORE: ä¸‰é‡ãƒ«ãƒ¼ãƒ—           0.001388ç§’
AFTER:  å†…åŒ…è¡¨è¨˜ï¼ˆãƒã‚¹ãƒˆï¼‰   0.003291ç§’

â†’ 137%é…ããªã£ãŸ âŒ
```

**å­¦ã³:**
- ãƒªã‚¹ãƒˆå†…åŒ…è¡¨è¨˜ãŒå¸¸ã«é€Ÿã„ã‚ã‘ã§ã¯ãªã„
- ãƒã‚¹ãƒˆã—ãŸå†…åŒ…è¡¨è¨˜ã¯é€†ã«é…ããªã‚‹å ´åˆãŒã‚ã‚‹
- **ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ©ãƒ¼ã§æ¤œè¨¼ã—ãªã„ã¨ã€Œæœ€é©åŒ–ã€ãŒé€†åŠ¹æœã«ãªã‚‹ã“ã¨ã‚‚ã‚ã‚‹**

---

## ğŸ“ ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

1. **ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒªãƒ³ã‚° â†’ æ”¹å–„ â†’ å†ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒªãƒ³ã‚°**
   - ã“ã®ã‚µã‚¤ã‚¯ãƒ«ã‚’å›ã™

2. **å¤§ããªãƒœãƒˆãƒ«ãƒãƒƒã‚¯ã‹ã‚‰é †ã«ç›´ã™**
   - % ãŒå¤§ãã„é–¢æ•°ã‹ã‚‰å„ªå…ˆ

3. **æ¤œè¨¼ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ®‹ã™**
   - `verify_improvement.py` ã®ã‚ˆã†ã«ã€æ”¹å–„å‰å¾Œã‚’æ¯”è¼ƒã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œã‚‹

4. **è‡ªå‹•ä¿å­˜ã•ã‚ŒãŸãƒ¬ãƒãƒ¼ãƒˆã‚’æ´»ç”¨**
   - æ™‚ç³»åˆ—ã§æ€§èƒ½ã®å¤‰åŒ–ã‚’è¿½ãˆã‚‹

---

## ğŸ› ï¸ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ç›¸å¯¾ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚¨ãƒ©ãƒ¼

```
ImportError: attempted relative import beyond top-level package
```

**åŸå› **: ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ©ãƒ¼çµŒç”±ã§å®Ÿè¡Œã™ã‚‹ã¨ã€ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ‘ã‚¹ãŒç•°ãªã‚‹

**å›é¿ç­–**: ç¾åœ¨ã€ã“ã®å•é¡Œã¯æœªè§£æ±ºã§ã™ã€‚`python main.py` ã‚’ç›´æ¥å®Ÿè¡Œã—ã¦ã€æ‰‹å‹•ã§ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒªãƒ³ã‚°ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚

### ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¨ãƒ©ãƒ¼

```
UnicodeEncodeError: 'cp932' codec can't encode character
```

**åŸå› **: Windowsã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãŒUTF-8ã‚’æ‰±ãˆãªã„

**å›é¿ç­–**: æ—¢ã«ä¿®æ­£æ¸ˆã¿ï¼ˆãƒã‚§ãƒƒã‚¯ãƒãƒ¼ã‚¯è¨˜å·ã‚’ `[*]` ã«å¤‰æ›´ï¼‰

### ãƒ­ã‚°å‡ºåŠ›ãŒæ··ã–ã‚‹

**ç¾çŠ¶**: ãƒ„ãƒ¼ãƒ«ã®ãƒ­ã‚°å‡ºåŠ›ã¨ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ©ãƒ¼çµæœãŒæ··åœ¨

**å›é¿ç­–**: ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã§å¯¾å¿œ
```bash
python -m pyprofiler main.py list 2>&1 | grep -A 20 "Function"
```

---

## ğŸ“š é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«

- `README.md` - åŸºæœ¬çš„ãªä½¿ã„æ–¹
- `docs/design.md` - è©³ç´°ãªä»•æ§˜
- `verify_improvement.py` - æ”¹å–„æ¤œè¨¼ã®ä¾‹
- `verify_improvement2.py` - è¡Œåˆ—æ¼”ç®—ã®ä¾‹
- `verify_improvement3.py` - è¾æ›¸æ“ä½œã®ä¾‹
- `verify_improvement4.py` - ã‚½ãƒ¼ãƒˆã®ä¾‹

---

**ä½œæˆæ—¥**: 2026-01-18
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 0.2.0
